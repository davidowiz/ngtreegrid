
<tr *ngIf="data.length==0">
  <td [innerHTML]="configs.data_loading_text" [attr.colspan]="columns.length + 1" style="text-align: center"></td>
</tr>
<tr db-add-row 
  [columns]="columns" 
  [configs]="configs" 
  [processed_data]="processed_data" 
  [data]="data"
  [group_keys]="group_keys"
  (rowadd)="rowAdd($event)"
  *ngIf="show_add_row">
</tr>

<tr 
  *ngFor="let data of processed_data" 
  [ngClass]="{'child': !data.parent, 'parent' : data.parent, 'selected': data.row_selected}" 
  [attr.id]="data['idx']" (click)="rowSelect(data)" 
  class="{{configs.row_class_function(data)}}"
  (keyup.enter)="saveRecord(data['idx'], data)">
  
  <!-- If parent text is empty then hide -->
  <ng-container *ngIf="expand_tracker[data.parent_id] && data.parent && !isEmpty(data.node_text)">
    <td *ngIf="(configs.actions.edit || configs.actions.add || configs.actions.delete)"></td>
    <!-- Leave left td for down level parents -->
    <td *ngFor="let level of range(data.level)"></td>
    <td *ngIf="!expand_tracker[data.node_id]" (click)="expandRow(data.node_id, data)"  
        class="clear-right-border" title="Expand row" >
        <i class="{{this.configs.css.expand_class}}" aria-hidden="true"></i>
        <span class="parent_container">{{data.node_text}}</span>
    </td>
    <td *ngIf="expand_tracker[data.node_id]" (click)="collapseRow(data.node_id, data)"  
      class="clear-right-border" title="Collapse row">
        <i class="{{this.configs.css.collapse_class}}" aria-hidden="true"></i>
        <span class="parent_container">{{data.node_text}}</span>
    </td>
    <!-- For parent levels add extra tds -->
    <td *ngFor="let level of range(configs.group_by.length - data.level + 1)"></td>
    <td *ngFor="let column of columns" [ngClass]="{'column-hide': column.hidden}" >
        <span [innerHTML]="column.group_aggregator && data.last_parent ? column.group_aggregator(fetchTraversedPaths(data.node_id)) : ''"></span>
    </td>
  </ng-container>
  <ng-container *ngIf="expand_tracker[data.parent_id] && !data.parent">
    <td db-tree-cell-actions 
      *ngIf="configs.actions.edit || configs.actions.delete || configs.actions.add" 
      [data]="data"
      [configs]="configs"
      [processed_data]="processed_data"
      [edit_tracker]="edit_tracker"
      (canceledit)="cancelEdit($event)" 
      (editcomplete)="saveRecord($event)" 
      (rowdelete)="rowdelete.emit($event)">
    </td>
    <td class="clear-right-border" *ngFor="let header of configs.group_by"></td>
    <td class="clear-left-border" *ngFor="let column of columns" [ngClass]="{'column-hide': column.hidden}">
      <db-tree-cell 
        [cell_value]="data[column.name]" 
        [row_data]="data" 
        [column]="column" 
        (cellclick)="cellClick($event)" 
        [edit_on]="edit_tracker[data['idx']]"
        (editcomplete)="saveRecord($event)">
      </db-tree-cell>            
    </td>
  </ng-container>
  
</tr>
